<!-- THIS FILE IS AUTOMATICALLY GENERATED, PLEASE DO NOT EDIT IT MANUALLY -->

# Messaging

All things about messages, typically chats between players.

Sending a message is done with the `messaging/send` request. When the sender
gets a successful response that means the message has been acked by the server
and it'll do its best to send it to the recipient(s).

There is no guarantee that the message has been actually received by the other
player, if, for example, the recipient disconnects at the same time the message
is received. A message can only be sent to online players. There is no support
to store messages to be then delivered later. In short, we're not building
whatsapp or discord.

Message are received through an event `messaging/received`. This means the server
has no way to guarantee a client acked a message. Each message contains a
special `marker` to allow some form of history seeking.

To receive messages, a client first has to subsribe to a given source. For now
the only supported source is `player` and means direct message from other
players.
The argument `since` is there as an option to ask the server some historical
events.
* `from_start` means the server will send its entire buffer.
* `latest` means the server will not send any potentially stored messages, only
  messages delivered after the subscription takes effect.
* `marker` with a corresponding value means the server will deliver all stored
  messages that have been sent *after* the message designated by the marker.
  This marker should be treated as an opaque value.

---
- [received](#received)
- [send](#send)
- [subscribeReceived](#subscribereceived)
---

## Received

Notify the player a message has been received

- Endpoint Type: **Event**
- Source: **Server**
- Target: **User**
- Required Scopes: `tachyon.lobby`

### Event

<details>
<summary>JSONSchema</summary>

```json
{
    "title": "MessagingReceivedEvent",
    "tachyon": {
        "source": "server",
        "target": "user",
        "scopes": ["tachyon.lobby"]
    },
    "type": "object",
    "properties": {
        "type": { "const": "event" },
        "messageId": { "type": "string" },
        "commandId": { "const": "messaging/received" },
        "data": {
            "title": "MessagingReceivedEventData",
            "type": "object",
            "properties": {
                "message": { "type": "string" },
                "source": {
                    "type": "object",
                    "properties": {
                        "type": { "const": "player" },
                        "player_id": { "type": "string" }
                    },
                    "required": ["type", "player_id"]
                },
                "marker": { "$ref": "../../definitions/unixTime.json" }
            },
            "required": ["message", "source", "marker"]
        }
    },
    "required": ["type", "messageId", "commandId", "data"]
}

```
</details>

<details>
<summary>Example</summary>

```json
{
    "type": "event",
    "messageId": "Duis Lorem",
    "commandId": "messaging/received",
    "data": {
        "message": "Duis Lorem",
        "source": {
            "type": "player",
            "player_id": "Duis Lorem"
        },
        "marker": 1705432698000000
    }
}
```
</details>

#### TypeScript Definition
```ts
export type UnixTime = number;

export interface MessagingReceivedEvent {
    type: "event";
    messageId: string;
    commandId: "messaging/received";
    data: MessagingReceivedEventData;
}
export interface MessagingReceivedEventData {
    message: string;
    source: {
        type: "player";
        player_id: string;
    };
    marker: UnixTime;
}
```
---

## Send

Send a simple message to the given target.

- Endpoint Type: **Request** -> **Response**
- Source: **User**
- Target: **Server**
- Required Scopes: `tachyon.lobby`

### Request

<details>
<summary>JSONSchema</summary>

```json
{
    "title": "MessagingSendRequest",
    "tachyon": {
        "source": "user",
        "target": "server",
        "scopes": ["tachyon.lobby"]
    },
    "type": "object",
    "properties": {
        "type": { "const": "request" },
        "messageId": { "type": "string" },
        "commandId": { "const": "messaging/send" },
        "data": {
            "title": "MessagingSendRequestData",
            "type": "object",
            "properties": {
                "target": {
                    "type": "object",
                    "properties": {
                        "type": { "const": "player" },
                        "player_id": { "type": "string" }
                    },
                    "required": ["type", "player_id"]
                },
                "message": { "type": "string", "maxLength": 512 }
            },
            "required": ["target", "message"]
        }
    },
    "required": ["type", "messageId", "commandId", "data"]
}

```
</details>

<details>
<summary>Example</summary>

```json
{
    "type": "request",
    "messageId": "consequat Lorem",
    "commandId": "messaging/send",
    "data": {
        "target": {
            "type": "player",
            "player_id": "consequat Lorem"
        },
        "message": "consequat Lorem"
    }
}
```
</details>

#### TypeScript Definition
```ts
export interface MessagingSendRequest {
    type: "request";
    messageId: string;
    commandId: "messaging/send";
    data: MessagingSendRequestData;
}
export interface MessagingSendRequestData {
    target: {
        type: "player";
        player_id: string;
    };
    message: string;
}
```
### Response

<details>
<summary>JSONSchema</summary>

```json
{
    "title": "MessagingSendResponse",
    "tachyon": {
        "source": "server",
        "target": "user",
        "scopes": ["tachyon.lobby"]
    },
    "anyOf": [
        {
            "title": "MessagingSendOkResponse",
            "type": "object",
            "properties": {
                "type": { "const": "response" },
                "messageId": { "type": "string" },
                "commandId": { "const": "messaging/send" },
                "status": { "const": "success" }
            },
            "required": ["type", "messageId", "commandId", "status"]
        },
        {
            "title": "MessagingSendFailResponse",
            "type": "object",
            "properties": {
                "type": { "const": "response" },
                "messageId": { "type": "string" },
                "commandId": { "const": "messaging/send" },
                "status": { "const": "failed" },
                "reason": {
                    "enum": [
                        "message_too_long",
                        "invalid_target",
                        "internal_error",
                        "unauthorized",
                        "invalid_request",
                        "command_unimplemented"
                    ]
                },
                "details": { "type": "string" }
            },
            "required": ["type", "messageId", "commandId", "status", "reason"]
        }
    ]
}

```
</details>

<details>
<summary>Example</summary>

```json
{
    "type": "response",
    "messageId": "commodo Lorem",
    "commandId": "messaging/send",
    "status": "success"
}
```
</details>

#### TypeScript Definition
```ts
export interface MessagingSendOkResponse {
    type: "response";
    messageId: string;
    commandId: "messaging/send";
    status: "success";
}
```
Possible Failed Reasons: `message_too_long`, `invalid_target`, `internal_error`, `unauthorized`, `invalid_request`, `command_unimplemented`

---

## SubscribeReceived

Ask the server to send events for relevant messages

- Endpoint Type: **Request** -> **Response**
- Source: **User**
- Target: **Server**
- Required Scopes: `tachyon.lobby`

### Request

<details>
<summary>JSONSchema</summary>

```json
{
    "title": "MessagingSubscribeReceivedRequest",
    "tachyon": {
        "source": "user",
        "target": "server",
        "scopes": ["tachyon.lobby"]
    },
    "type": "object",
    "properties": {
        "type": { "const": "request" },
        "messageId": { "type": "string" },
        "commandId": { "const": "messaging/subscribeReceived" },
        "data": {
            "title": "MessagingSubscribeReceivedRequestData",
            "type": "object",
            "properties": {
                "source": {
                    "type": "object",
                    "properties": {
                        "type": { "const": "player" },
                        "player_id": { "type": "string" }
                    },
                    "required": ["type", "player_id"]
                },
                "since": {
                    "anyOf": [
                        {
                            "type": "object",
                            "properties": { "type": { "const": "from_start" } },
                            "required": ["type"]
                        },
                        {
                            "type": "object",
                            "properties": { "type": { "const": "latest" } },
                            "required": ["type"]
                        },
                        {
                            "type": "object",
                            "properties": {
                                "type": { "const": "marker" },
                                "value": { "type": "integer" }
                            },
                            "required": ["type", "value"]
                        }
                    ]
                }
            },
            "required": ["source"]
        }
    },
    "required": ["type", "messageId", "commandId", "data"]
}

```
</details>

<details>
<summary>Example</summary>

```json
{
    "type": "request",
    "messageId": "ut Lorem",
    "commandId": "messaging/subscribeReceived",
    "data": {
        "source": {
            "type": "player",
            "player_id": "ut Lorem"
        },
        "since": {
            "type": "latest"
        }
    }
}
```
</details>

#### TypeScript Definition
```ts
export interface MessagingSubscribeReceivedRequest {
    type: "request";
    messageId: string;
    commandId: "messaging/subscribeReceived";
    data: MessagingSubscribeReceivedRequestData;
}
export interface MessagingSubscribeReceivedRequestData {
    source: {
        type: "player";
        player_id: string;
    };
    since?:
        | {
              type: "from_start";
          }
        | {
              type: "latest";
          }
        | {
              type: "marker";
              value: number;
          };
}
```
### Response

<details>
<summary>JSONSchema</summary>

```json
{
    "title": "MessagingSubscribeReceivedResponse",
    "tachyon": {
        "source": "server",
        "target": "user",
        "scopes": ["tachyon.lobby"]
    },
    "anyOf": [
        {
            "title": "MessagingSubscribeReceivedOkResponse",
            "type": "object",
            "properties": {
                "type": { "const": "response" },
                "messageId": { "type": "string" },
                "commandId": { "const": "messaging/subscribeReceived" },
                "status": { "const": "success" },
                "data": {
                    "title": "MessagingSubscribeReceivedOkResponseData",
                    "type": "object",
                    "properties": {
                        "history": {
                            "type": "array",
                            "items": {
                                "type": "object",
                                "properties": {
                                    "message": { "type": "string" },
                                    "marker": {
                                        "$ref": "../../definitions/unixTime.json"
                                    }
                                },
                                "required": ["message", "marker"]
                            }
                        },
                        "has_missed_messages": {
                            "description": "set to true when the marker sent doesn't match any message stored by the server.",
                            "type": "boolean"
                        }
                    },
                    "required": ["history", "has_missed_messages"]
                }
            },
            "required": ["type", "messageId", "commandId", "status"]
        },
        {
            "title": "MessagingSubscribeReceivedFailResponse",
            "type": "object",
            "properties": {
                "type": { "const": "response" },
                "messageId": { "type": "string" },
                "commandId": { "const": "messaging/subscribeReceived" },
                "status": { "const": "failed" },
                "reason": {
                    "enum": [
                        "internal_error",
                        "unauthorized",
                        "invalid_request",
                        "command_unimplemented"
                    ]
                },
                "details": { "type": "string" }
            },
            "required": ["type", "messageId", "commandId", "status", "reason"]
        }
    ]
}

```
</details>

<details>
<summary>Example</summary>

```json
{
    "type": "response",
    "messageId": "occaecat Lorem in",
    "commandId": "messaging/subscribeReceived",
    "status": "success",
    "data": {
        "history": [
            {
                "message": "occaecat Lorem in",
                "marker": 1705432698000000
            },
            {
                "message": "occaecat Lorem in",
                "marker": 1705432698000000
            },
            {
                "message": "occaecat Lorem in",
                "marker": 1705432698000000
            }
        ],
        "has_missed_messages": false
    }
}
```
</details>

#### TypeScript Definition
```ts
export type UnixTime = number;

export interface MessagingSubscribeReceivedOkResponse {
    type: "response";
    messageId: string;
    commandId: "messaging/subscribeReceived";
    status: "success";
    data?: MessagingSubscribeReceivedOkResponseData;
}
export interface MessagingSubscribeReceivedOkResponseData {
    history: {
        message: string;
        marker: UnixTime;
    }[];
    has_missed_messages: boolean;
}
```
Possible Failed Reasons: `internal_error`, `unauthorized`, `invalid_request`, `command_unimplemented`

